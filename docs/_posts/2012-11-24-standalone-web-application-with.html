---
layout: post
title: Standalone web application with executable Tomcat
date: '2012-11-24T23:10:00.001+01:00'
author: Tomasz Nurkiewicz
tags:
- maven
- tomcat
modified_time: '2012-11-24T23:10:49.867+01:00'
thumbnail: http://3.bp.blogspot.com/-EurNbXMLSKc/ULFFwD2dflI/AAAAAAAAArE/GNc3Ma2xYEM/s72-c/100_8265.JPG
blogger_id: tag:blogger.com,1999:blog-6753769565491687768.post-44264548476945502
blogger_orig_url: https://www.nurkiewicz.com/2012/11/standalone-web-application-with.html
---

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-EurNbXMLSKc/ULFFwD2dflI/AAAAAAAAArE/GNc3Ma2xYEM/s1600/100_8265.JPG" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="240" src="http://3.bp.blogspot.com/-EurNbXMLSKc/ULFFwD2dflI/AAAAAAAAArE/GNc3Ma2xYEM/s320/100_8265.JPG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Oslo City Hall from Tjuvholmen</td></tr></tbody></table>When it comes to deploying your application, simplicity is the biggest advantage. You'll understand that especially when project evolves and needs some changes in the environment. Packaging up your whole application in one, standalone and self-sufficient JAR seems like a good idea, especially compared to installing and upgrading Tomcat in target environment. In the past I would typically include Tomcat JARs in my web application and write thin command-line runner using Tomcat API. Luckily there is a <a href="http://tomcat.apache.org/maven-plugin-2.0/tomcat7-maven-plugin/exec-war-mojo.html"><code>tomcat7:exec-war</code> maven goal</a> that does just that. It takes your WAR artifact and packages it together with all Tomcat dependencies. At the end it also includes <a href="http://tomcat.apache.org/maven-plugin-2.0/apidocs/org/apache/tomcat/maven/runner/Tomcat7RunnerCli.html"><code>Tomcat7RunnerCli</code> Main-class</a> to manifest.<br /><br />Curious to try it? Take your existing WAR project and add the following to your <code>pom.xml</code>:<br /><br /><pre class="brush: xml">&lt;plugin&gt;<br />    &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;<br />    &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.0&lt;/version&gt;<br />    &lt;executions&gt;<br />        &lt;execution&gt;<br />            &lt;id&gt;tomcat-run&lt;/id&gt;<br />            &lt;goals&gt;<br />                &lt;goal&gt;exec-war-only&lt;/goal&gt;<br />            &lt;/goals&gt;<br />            &lt;phase&gt;package&lt;/phase&gt;<br />            &lt;configuration&gt;<br />                &lt;path&gt;/standalone&lt;/path&gt;<br />                &lt;enableNaming&gt;false&lt;/enableNaming&gt;<br />                &lt;finalName&gt;standalone.jar&lt;/finalName&gt;<br />                &lt;charset&gt;utf-8&lt;/charset&gt;<br />            &lt;/configuration&gt;<br />        &lt;/execution&gt;<br />    &lt;/executions&gt;<br />&lt;/plugin&gt;<br /></pre>Run <code>mvn package</code> and few seconds later you'll find shiny <code>standalone.jar</code> in your <code>target</code> directory. Running your web application was never that simple:<br /><a name='more'></a><br /><br /><pre class="brush: bash">$ java -jar target/standalone.jar<br /></pre>...and you can browse <code>localhost:8080/standalone</code>. Although the <a href="http://tomcat.apache.org/maven-plugin-2.0/tomcat7-maven-plugin/exec-war-mojo.html#path">documentation of <code>path</code> parameter</a> says (emphasis mine):<br /><br /><blockquote>The webapp context path to use for the web application being run. The name to store webapp in exec jar. <b>Do not use /</b></blockquote>just between the two of us, <code>&lt;path&gt;/&lt;/path&gt;</code> seems to work after all. It turns out that built in <code>main</code> class is actually a little bit more flexible. For example you can say (I hope it's self-explanatory):<br /><br /><pre class="brush: bash">$ java -jar standalone.jar -httpPort=7070<br /></pre>What this runnable JAR does is it first unpacks WAR file inside of it to some directory (<code>.extract</code> by default<sup>1</sup>) and deploys it to Tomcat - all required Tomcat JARs are also included. Empty <code>standalone.jar</code> (with few KiB WAR inside) weights around 8.5 MiB - not that much if you claim that pushing whole Tomcat with every release alongside your application is wasteful.<br /><br />Talking about Tomcat JARs, you should wonder how to choose Tomcat version included in this runnable? Unfortunately I couldn't find any simple option, so we must fall back to explicitly redefining <b>plugin</b> dependencies (version 2.0 has hardcoded 7.0.30 Tomcat). It's quite boring, but not that complicated and might be useful for future reference:<br /><br /><pre class="brush: xml">&lt;properties&gt;<br />    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br />    &lt;tomcat7Version&gt;7.0.33&lt;/tomcat7Version&gt;<br />&lt;/properties&gt;<br /><br />&lt;build&gt;<br />    &lt;plugins&gt;<br />        &lt;plugin&gt;<br />            &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;<br />            &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;<br />            &lt;version&gt;2.0&lt;/version&gt;<br />            &lt;executions&gt;<br />                &lt;execution&gt;<br />                    &lt;id&gt;tomcat-run&lt;/id&gt;<br />                    &lt;goals&gt;<br />                        &lt;goal&gt;exec-war-only&lt;/goal&gt;<br />                    &lt;/goals&gt;<br />                    &lt;phase&gt;package&lt;/phase&gt;<br />                    &lt;configuration&gt;<br />                        &lt;path&gt;/standalone&lt;/path&gt;<br />                        &lt;enableNaming&gt;false&lt;/enableNaming&gt;<br />                        &lt;finalName&gt;standalone.jar&lt;/finalName&gt;<br />                        &lt;charset&gt;utf-8&lt;/charset&gt;<br />                    &lt;/configuration&gt;<br />                &lt;/execution&gt;<br />            &lt;/executions&gt;<br />            &lt;dependencies&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-util&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-coyote&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-api&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-dbcp&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-servlet-api&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-jsp-api&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-jasper&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-jasper-el&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-el-api&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-catalina&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-tribes&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-catalina-ha&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />                &lt;dependency&gt;<br />                  &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;<br />                  &lt;artifactId&gt;tomcat-annotations-api&lt;/artifactId&gt;<br />                  &lt;version&gt;${tomcat7Version}&lt;/version&gt;<br />                &lt;/dependency&gt;<br />            &lt;/dependencies&gt;<br />        &lt;/plugin&gt;<br />    &lt;/plugins&gt;<br />&lt;/build&gt;<br /></pre>In the next article we will learn how to tame these pesky Tomcat internal logs appearing in the terminal (<code>java.util.logging</code>...) In the meantime I discovered and reported <a href="https://issues.apache.org/jira/browse/MTOMCAT-186"><i>MTOMCAT-186  Closing executable JAR does not call ServletContextListener.contextDestroyed()</i></a> - have look if this is a deal breaker for you.<br /><br /><sup>1</sup> - it might be a good idea to specify different directory using <code>-extractDirectory</code> and clean it before every restart with <code>-resetExtract</code>.  <script src="https://raw.github.com/gist/3983275/936845e66d98bb7c627684df7884f33b2cc368f5/syntaxhighlighter.js"></script>