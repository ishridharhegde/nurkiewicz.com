---
layout: post
title: Brute-forcing a seemingly simple number puzzle
date: '2018-09-26T21:01:00.000+02:00'
author: Tomasz Nurkiewicz
tags:
- game
modified_time: '2019-02-25T23:35:24.206+01:00'
thumbnail: https://4.bp.blogspot.com/-ySWSMJ71Gic/W6vUNHL-ynI/AAAAAAAAi-0/I1_z41CYSeoItiLfUbX3FW6HdJi34T17gCLcBGAs/s72-c/10x10.png
blogger_id: tag:blogger.com,1999:blog-6753769565491687768.post-8152712645736147993
blogger_orig_url: https://www.nurkiewicz.com/2018/09/brute-forcing-seemingly-simple-number.html
---

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-ySWSMJ71Gic/W6vUNHL-ynI/AAAAAAAAi-0/I1_z41CYSeoItiLfUbX3FW6HdJi34T17gCLcBGAs/s1600/10x10.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" data-original-height="410" data-original-width="413" height="198" src="https://4.bp.blogspot.com/-ySWSMJ71Gic/W6vUNHL-ynI/AAAAAAAAi-0/I1_z41CYSeoItiLfUbX3FW6HdJi34T17gCLcBGAs/s200/10x10.png" width="200" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">From <a href="https://puzzling.stackexchange.com/questions/20238/explore-the-square-with-100-hops">StackOverflow</a></td></tr></tbody></table>Something was bothering me for almost two decades. It was a pen and paper game that I learned when I was around 13. The rules are simple: on an empty 10x10 grid (100 squares in total) you put a number <em>1</em> on an arbitrary square. Starting from that square you can move horizontally or vertically jumping over two squares or diagonally jumping over one square. There you can place number <em>2</em>. Your task is to reach number <em>100</em>, filling all squares. You can not visit already visited squares. Here is an example of a solved game with a reduced 5x5 grid, starting at top-left corner:<br /><br /><table cellpadding="5" style="border: 1px solid black; text-align: center;"><tbody><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">1</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">24</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">14</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">2</span></td><td style="border: 1px solid black;"><span style="color: red; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">25</span></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">16</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">21</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">5</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">8</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">20</span></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">13</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">10</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">18</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">23</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">11</span></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">4</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">7</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">15</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">3</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">6</span></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">17</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">22</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">12</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">9</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">19</span></td></tr></tbody></table>On the other hand, if the program makes bad choices, we might get stuck without reaching the perfect score of 25 (on a reduced 5x5 grid):<br /><br /><table cellpadding="5" cellspacing="5" style="border: 1px solid black; text-align: center;"><tbody><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">1</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">8</span></td><td style="border: 1px solid black;"></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">2</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">9</span></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">16</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">13</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">5</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">17</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">14</span></td></tr><tr><td style="border: 1px solid black;"></td><td style="border: 1px solid black;"></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">10</span></td><td style="border: 1px solid black;"></td><td style="border: 1px solid black;"></td></tr><tr><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">4</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">7</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">15</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">3</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">6</span></td></tr><tr><td style="border: 1px solid black;"><span style="color: red; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">19</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">12</span></td><td style="border: 1px solid black;"></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">18</span></td><td style="border: 1px solid black;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">11</span></td></tr></tbody></table>Notice how we got stuck at number 19, unable to move anywhere and fill six remaining gaps. On an original 10x10 grid I never managed to reach the perfect score of <em>100</em>. Countless hours wasted at school, of trial and error. Anxious and jealous, I was waiting 20 years for this moment. Two decades later I finally understood recursion and decided to brute-force the shit out of this game!<br /><br /><h1 id="modeling-the-game">Modeling the game</h1>The game is a simple 10x10 grid with values ranging from <code>1</code> to <code>100</code>. Therefore we could use a two-dimensional <code>byte[][]</code> array. However, due to (most likely premature) optimization, I chose one-dimensional, unrolled array:<br /><br /><pre class="prettyprint linenums">class Board {<br /><br />    private static final int SIZE = 10;<br />    private static final int MAX = SIZE * SIZE;<br /><br />    private final byte[] values;<br /><br />    private Board(byte[] values) {<br />        this.values = values;<br />    }<br /><br />    //...<br /><br />}</pre>Next we need to store the position of last move. Technically we could scan through <code>values</code> array and look for highest value, but that seems suboptimal:<br /><br /><pre class="prettyprint linenums">class Board {<br /><br />    private static final int SIZE = 10;<br />    private static final int MAX = SIZE * SIZE;<br /><br />    private final byte[] values;<br />    private final int x;<br />    private final int y;<br /><br />    private Board(byte[] values, int x, int y) {<br />        this.values = values;<br />        this.x = x;<br />        this.y = y;<br />    }<br /><br />    static Board startingAt(int x, int y) {<br />        byte[] values = new byte[MAX];<br />        values[idx(x, y)] = 1;<br />        return new Board(values, x, y, listeners);<br />    }<br /><br />    private static int idx(int x, int y) {<br />        return y * SIZE + x;<br />    }<br />}</pre>Notice how we create an empty board and place number <code>1</code> in selected square in <code>startingAt()</code> factory method. The current score is simply the highest value on board:<br /><br /><pre class="prettyprint linenums">int score() {<br />    return values[idx(x, y)];<br />}</pre>Before we move further, let's define possible moves. There are 8 possible directions where we can jump:<br /><br /><pre class="prettyprint linenums">static final int HV_OFFSET = 3;<br />static final int DIAG_OFFSET = 2;<br /><br />enum Direction {<br />    DOWN(0, HV_OFFSET),<br />    DOWN_RIGHT(DIAG_OFFSET, DIAG_OFFSET),<br />    RIGHT(HV_OFFSET, 0),<br />    UP_RIGHT(DIAG_OFFSET, -DIAG_OFFSET),<br />    UP(0, -HV_OFFSET),<br />    UP_LEFT(-DIAG_OFFSET, -DIAG_OFFSET),<br />    LEFT(-HV_OFFSET, 0),<br />    DOWN_LEFT(-DIAG_OFFSET, DIAG_OFFSET);<br /><br />    final int xDelta;<br />    final int yDelta;<br /><br />    Direction(int xDelta, int yDelta) {<br />        this.xDelta = xDelta;<br />        this.yDelta = yDelta;<br />    }<br />}</pre><code>xDelta</code> and <code>yDelta</code> tell how many squares we move along X and Y axis respectively. For example,&nbsp;&nbsp;<code>DOWN&nbsp;</code>means no changes along X axis and adding <code>3</code> along Y axis. Having declarative definitions of each possible move we can build a method that performs all of them:<br /><br /><pre class="prettyprint linenums">private List&lt;Board&gt; nextMoves() {<br />    List&lt;Board&gt; next = new ArrayList&lt;&gt;(Direction.values().length);<br />    for (Direction dir : Direction.values()) {<br />        final Board b = move(dir);<br />        if (b != null) {<br />            next.add(b);<br />        }<br />    }<br />    return next;<br />}<br /><br />private Board move(Direction dir) {<br />    final int newX = x + dir.yDelta;<br />    final int newY = y + dir.xDelta;<br />    if (newX &lt; 0 || newX &gt;= SIZE) {<br />        return null;<br />    }<br />    if (newY &lt; 0 || newY &gt;= SIZE) {<br />        return null;<br />    }<br />    if (values[idx(newX, newY)] != 0) {<br />        return null;<br />    }<br />    final byte[] newValues = new byte[MAX];<br />    System.arraycopy(values, 0, newValues, 0, MAX);<br />    newValues[idx(newX, newY)] = (byte) (score() + 1);<br />    return new Board(newValues, newX, newY, listeners);<br />}</pre>There's quite a bit of logic here! First of all we iterate over all possible directions and try to <code>move()</code>. The <code>move()</code> method may return <code>null</code> if:<br /><br /><ul><li>X or Y coordinate after move would be out of range</li><li>target square is already occupied (values different than <code>0</code>)</li></ul>If given move is valid (no matter if it makes sense in the longer run), we create new <code>Board</code> after applying this move. If our current score is e.g. <code>17</code>, we place <code>18</code> on the target square. Why creating a new instance of <code>Board</code> instead of mutating it? It'll make recursion simpler and enable parallelizing work!<br /><br />Now the hardest part. We can create an empty <code>Board</code> with a starting point <code>1</code> and we can generate all possible moves (boards) immediately following that first move. If we continue this process recursively (generating every possible move starting from every possible move) we will eventually explore every single path we could take. Brute force. The recursion looks as follows:<br /><br /><pre class="prettyprint linenums">Board explore() {<br />    List&lt;Board&gt; next = nextMoves();<br />    for (Board board : next) {<br />        if (board.score() == MAX) {<br />            return board;<br />        }<br />    }<br />    for (Board board : next) {<br />        Board solution = board.explore();<br />        if (solution != null) {<br />            return solution;<br />        }<br />    }<br />    return null;<br />}</pre>First, we generate all valid moves. If any of these moves has a <code>score()</code> of <code>MAX</code> (<code>100</code>) we return a solution. Otherwise we iterate over all valid moves and recursively explore them further down. If no branch provides a solution, it means we are stuck in a dead end. Returning <code>null</code> means just that. This builds a complete game tree with every possible move. The fact that <code>Board</code> is immutable means we don't have to perform any cleanup when backtracking. What does it mean? When one of the branches is stuck in a dead end, we must slowly go back, trying to take all other possible moves. Mutating <code>Board</code> would require cleaning it up. Immutable <code>Board</code> can be simply thrown away once it's no longer needed. Also immutability enables concurrent exploration (soon to come).<br /><br />How many moves do we have to examine? First, we must choose a starting point (<code>n&lt;sup&gt;2&lt;/sup&gt;</code>, where <code>n = 10</code>, 100 possible squares). Then we must always examine 8 possible moves (not all of them are valid). For each move we must examine 8 further moves (so 64 in total). For each of these 64 moves we must examine 8 further moves... In general: <code>n<sup>2</sup>8<sup>n-1</sup></code><br /><br />Complexity also known as <code>O(insane)</code>. The number of boards to examine has 92 digits, billion times more than atoms in the Universe. Ouch! Let's run it anyway! Apart from what you already saw, I added a pluggable <code>Listeners</code> interface that can be used to track the progress of brute-force process:<br /><br /><pre class="prettyprint linenums">interface Listeners {<br />    void onBoard(Board b);<br /><br />    void onSolution(Board b);<br /><br />    void onStuck(Board b);<br />}</pre>With a simple implementation that prints some useful statistics:<br /><br /><pre class="prettyprint linenums">import com.google.common.util.concurrent.RateLimiter;<br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br /><br />import java.text.NumberFormat;<br />import java.time.Duration;<br />import java.time.Instant;<br />import java.util.ArrayList;<br />import java.util.List;<br />import java.util.Locale;<br />import java.util.concurrent.atomic.AtomicLong;<br />import java.util.concurrent.atomic.LongAdder;<br /><br />class LoggingListeners implements Listeners {<br /><br />    private static final Logger log = LoggerFactory.getLogger(LoggingListeners.class);<br /><br />    private final Instant start = Instant.now();<br />    private final AtomicLong maxScore = new AtomicLong();<br />    private final LongAdder totalExamined = new LongAdder();<br />    private final RateLimiter logLimiter = RateLimiter.create(0.1);<br /><br />    @Override<br />    public void onBoard(Board b) {<br />        totalExamined.increment();<br />        if (logLimiter.tryAcquire()) {<br />            log.info("Examined {} so far ({}K/s)", total(), throughput());<br />        }<br />    }<br /><br />    @Override<br />    public void onSolution(Board b) {<br />        final Duration duration = Duration.between(start, Instant.now());<br />        log.info("Found solution in {}, examined {} ({}K/s):\n{}", duration, total(), throughput(), b);<br />    }<br /><br />    @Override<br />    public void onStuck(Board b) {<br />        if (b.score() &gt; maxScore.get()) {<br />            log.info("Current max score is {} after {} examined:\n{}", b.score(), total(), b);<br />            maxScore.set(b.score());<br />        }<br />    }<br /><br />    private int throughput() {<br />        final Duration duration = Duration.between(start, Instant.now());<br />        return (int) (totalExamined.longValue() / Math.max(duration.toMillis(), 1));<br />    }<br /><br />    private String total() {<br />        return NumberFormat<br />                .getNumberInstance(Locale.US)<br />                .format(totalExamined.longValue());<br />    }<br />}</pre>The complete <code>Board</code> implementation looks as follows:<br /><br /><pre class="prettyprint linenums">class Board {<br /><br />    private static final int SIZE = 10;<br />    private static final int MAX = SIZE * SIZE;<br /><br />    static final int HV_OFFSET = 3;<br />    static final int DIAG_OFFSET = 2;<br /><br />    private final byte[] values;<br />    private final int x;<br />    private final int y;<br />    private final Listeners listeners;<br /><br />    private Board(byte[] values, int x, int y, Listeners listeners) {<br />        this.values = values;<br />        this.x = x;<br />        this.y = y;<br />        this.listeners = listeners;<br />    }<br /><br />    int score() {<br />        return values[idx(x, y)];<br />    }<br /><br />    static Board startingAt(int x, int y, Listeners listeners) {<br />        byte[] values = new byte[MAX];<br />        values[idx(x, y)] = 1;<br />        return new Board(values, x, y, listeners);<br />    }<br /><br />    Board explore() {<br />        List&lt;Board&gt; next = nextMoves();<br />        for (Board board : next) {<br />            listeners.onBoard(board);<br />            if (board.score() == MAX) {<br />                listeners.onSolution(board);<br />                return board;<br />            }<br />        }<br />        for (Board board : next) {<br />            Board solution = board.explore();<br />            if (solution != null) {<br />                return solution;<br />            }<br />        }<br />        listeners.onStuck(this);<br />        return null;<br />    }<br /><br />    private List&lt;Board&gt; nextMoves() {<br />        List&lt;Board&gt; next = new ArrayList&lt;&gt;(Direction.values().length);<br />        for (Direction dir : Direction.values()) {<br />            final Board b = move(dir);<br />            if (b != null) {<br />                next.add(b);<br />            }<br />        }<br />        return next;<br />    }<br /><br />    private Board move(Direction dir) {<br />        final int newX = x + dir.yDelta;<br />        final int newY = y + dir.xDelta;<br />        if (newX &lt; 0 || newX &gt;= SIZE) {<br />            return null;<br />        }<br />        if (newY &lt; 0 || newY &gt;= SIZE) {<br />            return null;<br />        }<br />        if (values[idx(newX, newY)] != 0) {<br />            return null;<br />        }<br />        final byte[] newValues = new byte[MAX];<br />        System.arraycopy(values, 0, newValues, 0, MAX);<br />        newValues[idx(newX, newY)] = (byte) (score() + 1);<br />        return new Board(newValues, newX, newY, listeners);<br />    }<br /><br />    private static int idx(int x, int y) {<br />        return y * SIZE + x;<br />    }<br /><br />    @Override<br />    public String toString() {<br />        StringBuilder sb = new StringBuilder();<br />        for (int y = 0; y &lt; SIZE; ++y) {<br />            for (int x = 0; x &lt; SIZE; ++x) {<br />                final int value = values[idx(x, y)];<br />                if (value &lt; 100) {<br />                    sb.append(' ');<br />                }<br />                if (value &lt; 10) {<br />                    sb.append(' ');<br />                }<br />                if (value == 0) {<br />                    sb.append('.');<br />                } else {<br />                    sb.append(value);<br />                }<br />                if (x &lt; SIZE - 1) {<br />                    sb.append(' ');<br />                }<br />            }<br />            if (y &lt; SIZE - 1) {<br />                sb.append('\n');<br />            }<br />        }<br />        return sb.toString();<br />    }<br />}</pre>Enough of coding, let's run it! But first let's make sure it actually works with smaller data set:<br /><br /><pre class="prettyprint linenums">private static final int SIZE = 5;<br /><br />final Listeners listeners = new LoggingListeners();<br />Board.startingAt(0, 0, listeners).explore();</pre>The solution to 5x5 grid (reaching 25) was found in about 100 ms:<br /><br /><pre class="prettyprint linenums">19:37:59.117 | Current max score is 19 after 32 examined:<br />  1   8   .   2   9<br /> 16  13   5  17  14<br />  .   .  10   .   .<br />  4   7  15   3   6<br /> 19  12   .  18  11<br />19:37:59.122 | Current max score is 23 after 38 examined:<br />  1   8   .   2   9<br /> 16  13   5  17  14<br /> 22  19  10  23  20<br />  4   7  15   3   6<br />  .  12  21  18  11<br />19:37:59.123 | Current max score is 24 after 75 examined:<br />  1   8  16   2   9<br /> 23  13   5  24  14<br /> 17  20  10   .  19<br />  4   7  15   3   6<br /> 22  12  18  21  11<br />19:37:59.130 | Found solution in PT0.041S, examined 1,381 (33M/s):<br />  1  24  14   2  25<br /> 16  21   5   8  20<br /> 13  10  18  23  11<br />  4   7  15   3   6<br /> 17  22  12   9  19</pre>Notice how the first top score found was <code>19</code> and the algorithm got stuck, it had to backtrack. The next best score was <code>23</code>, <code>24</code> and finally perfect <code>25</code>, filling all the squares. So it works, let's try it with the original problem of 10x10 grid:<br /><br /><pre class="prettyprint linenums">19:44:09.135 | Current max score is 52 after 178 examined:<br />  1   .   .   2   .   .   3   .   .   4<br />  .   .   .   .   .   .   .   .   .   .<br />  .   .   .   .   .   .   .   .   .   .<br />  .   .   .   .   .   .   .   .   .   5<br />  .   .  51   .   .  50   .   .  49   .<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25   .  12  26  40  13  27  39   6<br />  .   .  52   .   .  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24   .   9  23  37   8  22  38   7<br />19:44:09.135 | Current max score is 67 after 220 examined:<br />  1   .   .   2   .   .   3   .   .   4<br />  .   .   .   .   .   .   .   .   .   .<br /> 52  67   .  53  66   .  54  65   .  55<br />  .   .   .   .   .   .   .   .   .   5<br />  .   .  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25   .  12  26  40  13  27  39   6<br /> 60   .   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.136 | Current max score is 86 after 255 examined:<br />  1  82  67   2  83  68   3  84  69   4<br /> 75   .   .  76   .   .  77   .   .  78<br /> 52   .   .  53  66  85  54  65  86  55<br />  .  81  72   .  80  71   .  79  70   5<br /> 74   .  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60   .   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.136 | Current max score is 88 after 270 examined:<br />  1   .  67   2   .  68   3   .  69   4<br /> 75  86  81  76  87  82  77  88  83  78<br /> 52   .   .  53  66   .  54  65   .  55<br />  .   .  72  85  80  71  84  79  70   5<br /> 74   .  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60   .   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.136 | Current max score is 90 after 317 examined:<br />  1   .  67   2   .  68   3   .  69   4<br /> 75  88  81  76  87  84  77   .  85  78<br /> 52   .   .  53  66   .  54  65   .  55<br /> 82   .  72  83  80  71  86  79  70   5<br /> 74  89  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60  90   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.137 | Current max score is 92 after 346 examined:<br />  1  88  67   2  89  68   3  90  69   4<br /> 75   .  85  76   .  80  77   .  81  78<br /> 52   .   .  53  66  91  54  65  92  55<br /> 84  87  72  83  86  71  82  79  70   5<br /> 74   .  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60   .   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.137 | Current max score is 94 after 379 examined:<br />  1  90  67   2  91  68   3  92  69   4<br /> 75  84  87  76  83  80  77   .  81  78<br /> 52   .   .  53  66  93  54  65  94  55<br /> 86  89  72  85  88  71  82  79  70   5<br /> 74   .  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60   .   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.138 | Current max score is 96 after 602 examined:<br />  1  84  67   2  83  68   3  80  69   4<br /> 75  94  87  76  93  90  77   .  91  78<br /> 52   .  82  53  66  81  54  65   .  55<br /> 88  85  72  89  86  71  92  79  70   5<br /> 74  95  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  73  12  26  40  13  27  39   6<br /> 60  96   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.166 | Current max score is 97 after 30,829 examined:<br />  1  89  67   2  88  68   3  87  69   4<br /> 81  95  92  80  73  76  79  72  75  78<br /> 52   .  85  53  66  86  54  65   .  55<br /> 93  90  82  94  91  71  74  77  70   5<br /> 84  96  51  62  57  50  63  56  49  64<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  83  12  26  40  13  27  39   6<br /> 60  97   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:09.683 | Current max score is 98 after 2,165,687 examined:<br />  1  90  77   2  89  78   3  88  79   4<br /> 70  96  93  71  83  86  72  82  85  73<br /> 52   .  66  53  76  65  54  75  64  55<br /> 94  91  69  95  92  81  84  87  80   5<br /> 67  97  51  62  57  50  63  56  49  74<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  68  12  26  40  13  27  39   6<br /> 60  98   .  61  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  59   9  23  37   8  22  38   7<br />19:44:19.121 | Examined 64,805,972 so far (6469K/s)<br />19:44:20.699 | Current max score is 99 after 76,321,898 examined:<br />  1  97  82   2  98  67   3  99  66   4<br /> 84  61  94  85  62  89  86  63  90  87<br /> 52  80  73  53  81  72  54  68  71  55<br /> 93  96  83  92  95  64  91  88  65   5<br /> 74  60  51  79  57  50  70  56  49  69<br /> 32  44  17  33  45  18  34  46  19  35<br /> 11  25  75  12  26  40  13  27  39   6<br /> 77  59   .  78  58  47  20  36  48  21<br /> 31  43  16  30  42  15  29  41  14  28<br /> 10  24  76   9  23  37   8  22  38   7<br />19:44:29.121 | Examined 139,819,549 so far (6985K/s)<br />19:44:39.120 | Examined 216,100,690 so far (7199K/s)<br />19:44:49.120 | Examined 287,468,941 so far (7183K/s)<br />19:44:59.119 | Examined 361,736,638 so far (7232K/s)<br />19:45:09.120 | Examined 437,409,160 so far (7288K/s)<br />...<br />20:29:29.015 | Examined 19,985,852,124 so far (7347K/s)<br />20:29:39.015 | Examined 20,059,067,812 so far (7347K/s)<br />20:29:49.015 | Examined 20,132,070,269 so far (7347K/s)<br />20:29:59.014 | Examined 20,202,977,476 so far (7346K/s)<br />20:30:09.014 | Examined 20,277,545,427 so far (7347K/s)<br />20:30:19.014 | Examined 20,345,749,056 so far (7345K/s)<br />20:30:29.013 | Examined 20,414,805,092 so far (7343K/s)</pre>After 45 minutes the program was stuck in local minimum. It quickly found the solution of <code>98</code> and after few more seconds <code>99</code>. However it's not capable of finding perfect <code>100</code>, despite more than 20 billion boards examined (7 million per second (!)) Turns out the starting point is extremely important. The exact same program, but starting in the middle (at <code>(5, 5)</code>) rather than in the corner <strong>finds the solution</strong> in about 3 seconds:<br /><br /><pre class="prettyprint linenums">20:35:14.292 | Current max score is 67 after 218 examined:<br />  .   .   .   .   .   .   .   .   .   .<br />  .   .   .   .   .   .  57   .   .  58<br />  .   .   .   .   .   .  40  47   .  41<br />  .   .  54   .  60  55   .  59  56   .<br /> 65   .   .  64   .  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34  67  12  33  28  11  32  29  10<br />20:35:14.292 | Current max score is 79 after 246 examined:<br /> 76   .   .  77   .   .  78   .   .  79<br />  .  69   .   .  70   .  57  71   .  58<br />  .   .   .   .   .   .  40  47   .  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68   .  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.293 | Current max score is 83 after 252 examined:<br /> 76   .   .  77  82   .  78  83   .   .<br />  .  69   .   .  70   .  57  71   .  58<br />  .   .  81   .   .  80  40  47  79  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68   .  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.293 | Current max score is 89 after 262 examined:<br /> 76  83   .  77  82   .  78   .   .   .<br />  .  69  87   .  70  88  57  71  89  58<br /> 85   .  81  84   .  80  40  47  79  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68  86  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.293 | Current max score is 90 after 266 examined:<br /> 76  83  88  77  82  89  78   .  90   .<br />  .  69   .   .  70   .  57  71   .  58<br /> 85   .  81  84  87  80  40  47  79  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68  86  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.293 | Current max score is 91 after 274 examined:<br /> 76  83  86  77  82   .  78   .   .   .<br />  .  69  89   .  70  90  57  71  91  58<br /> 85   .  81  84  87  80  40  47  79  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68  88  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.295 | Current max score is 93 after 719 examined:<br /> 76  85  88  77  84  87  80   .   .   .<br />  .  69  91   .  70  92  57  71  93  58<br /> 89  78  83  86  79  82  40  47  81  41<br /> 75   .  54  74  60  55  73  59  56  72<br /> 65  68  90  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.297 | Current max score is 94 after 1,140 examined:<br /> 76  91  88  83  78  89  82  79   .   .<br /> 94  69   .  93  70   .  57  71   .  58<br /> 87  84  77  90  85  80  40  47  81  41<br /> 75  92  54  74  60  55  73  59  56  72<br /> 65  68  86  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.301 | Current max score is 95 after 3,454 examined:<br /> 84  92  89  75  82  90  78  81   .   .<br /> 95  69  86  94  70   .  57  71   .  58<br /> 88  76  83  91  77  80  40  47  79  41<br /> 85  93  54  74  60  55  73  59  56  72<br /> 65  68  87  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.304 | Current max score is 96 after 5,663 examined:<br /> 78  93  90  85  80  91  84  81   .   .<br /> 96  69  76  95  70  75  57  71   .  58<br /> 89  86  79  92  87  82  40  47  83  41<br /> 77  94  54  74  60  55  73  59  56  72<br /> 65  68  88  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.312 | Current max score is 97 after 13,933 examined:<br /> 86  94  91  77  84  92  80  83   .   .<br /> 97  69  88  96  70  75  57  71  74  58<br /> 90  78  85  93  79  82  40  47  81  41<br /> 87  95  54  76  60  55  73  59  56  72<br /> 65  68  89  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.315 | Current max score is 98 after 19,845 examined:<br /> 80  95  92  87  78  93  74  77   .  73<br /> 98  69  82  97  70  83  57  71  84  58<br /> 91  88  79  94  89  76  40  47  75  41<br /> 81  96  54  86  60  55  85  59  56  72<br /> 65  68  90  64  67  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  66   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34   .  12  33  28  11  32  29  10<br />20:35:14.412 | Current max score is 99 after 421,749 examined:<br /> 95  69  89  94  70  88  74  71   .  75<br /> 66  85  82  67  78  81  57  77  80  58<br /> 90  93  96  87  92  72  40  47  73  41<br /> 83  68  54  84  60  55  79  59  56  76<br /> 65  86  91  64  97  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  98   7  36  43   8  37  44   9<br /> 62  25  14  63  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34  99  12  33  28  11  32  29  10<br />20:35:17.731 | Found solution in PT3.468S, examined 18,392,716 (5303K/s):<br /> 94  82  98  95  81  99  77  80 100  76<br /> 85  72  67  84  73  66  57  74  65  58<br /> 69  96  93  70  97  79  40  47  78  41<br /> 62  83  54  63  60  55  64  59  56  75<br /> 86  71  68  87  92  38  45  42  39  46<br /> 23  52  61  24  53   1  17  48   2  18<br />  6  35  91   7  36  43   8  37  44   9<br /> 89  25  14  88  26  15  30  27  16  31<br /> 22  51   5  21  50   4  20  49   3  19<br /> 13  34  90  12  33  28  11  32  29  10</pre><h1 id="conclusion">Conclusion</h1>I was hoping to use this simple game as a fun exercise in concurrency (<code>ForkJoinPool</code> in particular). Unfortunately, the single core performance seems sufficient... But at least I know this game can be beaten. Well, there are actually <a href="https://puzzling.stackexchange.com/questions/20238/explore-the-square-with-100-hops">much easier ways to prove that</a>...<br /><br /><h1 id="ps-optimizations">PS: optimizations</h1>I mentioned that the usage of <code>byte</code> array instead of <code>int</code> was most likely a premature optimization. But the following trick definitely wasn't. Did you notice this clumsy, old-school loop?<br /><br /><pre class="prettyprint linenums">private List&lt;Board&gt; nextMoves() {<br />    List&lt;Board&gt; next = new ArrayList&lt;&gt;(Direction.values().length);<br />    for (Direction dir : Direction.values()) {<br />        final Board b = move(dir);<br />        if (b != null) {<br />            next.add(b);<br />        }<br />    }<br />    return next;<br />}</pre>It sure is ugly, compared to shiny functional stream:<br /><br /><pre class="prettyprint linenums">return Arrays<br />        .stream(Direction.values())<br />        .map(this::move)<br />        .filter(Objects::nonNull)<br />        .collect(toList());</pre>Why? Because it's twice as slow <em>in this particular program</em>. In general, you should prefer streams.<br /><br />